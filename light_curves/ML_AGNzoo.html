
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>How do AGNs selected with different techniques compare? &#8212; Fornax Demo Notebooks</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Light Curve Classifier" href="lc_classifier.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/fornax_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Fornax Demo Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Fornax Demo Notebooks
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../forced_photometry/README.html">
   Multi-band forced photometry
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../forced_photometry/multiband_photometry.html">
     Automated Multiband Forced Photometry on Large Datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="README.html">
   Time Domain
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="multiband_lc.html">
     Make multiwavelength light curves using archival data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lc_classifier.html">
     Light Curve Classifier
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     How do AGNs selected with different techniques compare?
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/fornax-navo/fornax-demo-notebooks/main?urlpath=tree/light_curves/ML_AGNzoo.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/fornax-navo/fornax-demo-notebooks/blob/main/light_curves/ML_AGNzoo.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/fornax-navo/fornax-demo-notebooks"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/fornax-navo/fornax-demo-notebooks/issues/new?title=Issue%20on%20page%20%2Flight_curves/ML_AGNzoo.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/fornax-navo/fornax-demo-notebooks/edit/main/light_curves/ML_AGNzoo.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/light_curves/ML_AGNzoo.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../_sources/light_curves/ML_AGNzoo.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   How do AGNs selected with different techniques compare?
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-is-in-this-sample">
     What is in this sample?
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#looking-at-ztf-lightcurves-alone">
     Looking at ZTF lightcurves alone
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#repeating-the-above-this-time-with-panstarrs-observations">
   Repeating the above, this time with Panstarrs observations
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ztf-wise">
   ZTF + WISE
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#wise-alone">
   Wise alone
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>How do AGNs selected with different techniques compare?</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   How do AGNs selected with different techniques compare?
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-is-in-this-sample">
     What is in this sample?
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#looking-at-ztf-lightcurves-alone">
     Looking at ZTF lightcurves alone
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#repeating-the-above-this-time-with-panstarrs-observations">
   Repeating the above, this time with Panstarrs observations
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ztf-wise">
   ZTF + WISE
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#wise-alone">
   Wise alone
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="how-do-agns-selected-with-different-techniques-compare">
<h1>How do AGNs selected with different techniques compare?<a class="headerlink" href="#how-do-agns-selected-with-different-techniques-compare" title="Permalink to this headline">#</a></h1>
<p>By the IPAC Science Platform Team, last edit: Sep 25th, 2024</p>
<p>Active Galactic Nuclei (AGNs), some of the most powerful sources in the universe, emit a broad range of electromagnetic radiation, from radio waves to gamma rays. Consequently, there is a wide variety of AGN labels depending on the identification/selection scheme and the presence or absence of certain emissions (e.g., Radio loud/quiet, Quasars, Blazars, Seiferts, Changing looks). According to the unified model, this zoo of labels we see depend on a limited number of parameters, namely the viewing angle, the accretion rate, presence or lack of jets, and perhaps the properties of the host/environment (e.g., <a class="reference external" href="https://arxiv.org/pdf/1707.07134.pdf">Padovani et al. 2017</a>). Here, we collect archival temporal data and labels from the literature to compare how some of these different labels/selection schemes compare.</p>
<p>We use manifold learning and dimensionality reduction to learn the distribution of AGN lightcurves observed with different facilities. We mostly focus on UMAP (<a class="reference external" href="https://arxiv.org/pdf/1802.03426.pdf">Uniform Manifold Approximation and Projection, McInnes 2020</a>) but also show two SOM (<a class="reference external" href="https://ieeexplore.ieee.org/document/58325">Self organizing Map, Kohonen 1990</a>) examples. The reduced 2D projections from these two unsupervised ML techniques reveal similarities and overlaps of different selection techniques and coloring the projections with various statistical physical properties (e.g., mean brightness, fractional lightcurve variation) is informative of correlations of the selections technique with physics such as AGN variability. Using different parts of the EM in training (or in building the initial higher dimensional manifold) demonstrates how much information if any is in that part of the data for each labeling scheme, for example whether with ZTF optical light curves alone, we can identify sources with variability in WISE near IR bands. These techniques also have a potential for identifying targets of a specific class or characteristic for future follow up observations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>#!pip install -r requirements.txt
import sys
import os
import re
import time
import astropy.units as u
import matplotlib.pyplot as plt
import matplotlib as mpl
import matplotlib.cm as cm
import numpy as np
import pandas as pd
sys.path.append(&#39;code_src/&#39;)
from data_structures import MultiIndexDFObject
from ML_utils import unify_lc, stat_bands, autopct_format, combine_bands,\
mean_fractional_variation, normalize_mean_objects, normalize_max_objects, \
normalize_clipmax_objects, shuffle_datalabel, dtw_distance, stretch_small_values_arctan
from sample_lc import build_sample
from sklearn.cluster import KMeans
from sklearn.preprocessing import StandardScaler
try:
    import umap
    import umap.plot
except:
    !pip install umap-learn[plot]

import warnings
warnings.filterwarnings(&#39;ignore&#39;)

plt.style.use(&#39;bmh&#39;)
colors = [
    &quot;#6C907D&quot;,  # Soft Green
    &quot;#B9C3C2&quot;,  # Pale Gray
    &quot;#8C9EFF&quot;,  # Periwinkle Blue
    &quot;#FF6347&quot;,  # Tomato Red
    &quot;#66CDAA&quot;,  # Medium Aquamarine
    &quot;#E6E6FA&quot;,  # Lavender
    &quot;#FAFAD2&quot;,  # Light Goldenrod Yellow
    &quot;#FFD700&quot;,  # Gold
]

# To build a sample and generate the multiindex lc dataframe the code below is used, which takes long:
#!python sample_lc.py
#c,l = build_sample() # if coordinates and labels of the sample are needed separately
</pre></div>
</div>
</div>
</div>
<p>Here we load a parquet file of light curves generated using the multiband_lc notebook. One can build the sample from different sources in the literature and grab the data from archives of interes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parquet_loadname</span> <span class="o">=</span> <span class="s1">&#39;output/df_lc_5k.parquet.gzip&#39;</span>
<span class="n">parallel_df_lc</span> <span class="o">=</span> <span class="n">MultiIndexDFObject</span><span class="p">()</span>
<span class="n">parallel_df_lc</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">parquet_loadname</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="what-is-in-this-sample">
<h2>What is in this sample?<a class="headerlink" href="#what-is-in-this-sample" title="Permalink to this headline">#</a></h2>
<p>To effectively undertake machine learning (ML) in addressing a specific question, it’s imperative to have a clear understanding of the data we’ll be utilizing. This understanding aids in selecting the appropriate ML approach and, critically, allows for informed and necessary data preprocessing. For example whether a normalization is needed, and what band to choose for normalization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="n">objid</span> <span class="o">=</span> <span class="n">parallel_df_lc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;objectid&#39;</span><span class="p">)[:]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">seen</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

<span class="c1"># Grouping all changing look AGNs from the literature into one class:</span>
<span class="n">cl_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LaMassa 15&#39;</span><span class="p">,</span><span class="s1">&#39;Green 22&#39;</span><span class="p">,</span><span class="s1">&#39;Hon 22&#39;</span><span class="p">,</span><span class="s1">&#39;Lyu 21&#39;</span><span class="p">,</span><span class="s1">&#39;Sheng 20&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 19&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 16&#39;</span><span class="p">,</span><span class="s1">&#39;Ruan 16&#39;</span><span class="p">,</span><span class="s1">&#39;Yang 18&#39;</span><span class="p">,</span><span class="s1">&#39;Lopez-Navas 22&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">objid</span><span class="p">:</span>
    <span class="n">singleobj</span> <span class="o">=</span> <span class="n">parallel_df_lc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">b</span><span class="p">,:,:,:]</span>  
    <span class="n">label</span> <span class="o">=</span> <span class="n">singleobj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cl_labels</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CL AGN&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">label</span><span class="o">==</span><span class="s1">&#39;ZTF-Objname&#39;</span><span class="p">:</span>
        <span class="n">label</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TDE&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">label</span><span class="o">==</span><span class="s1">&#39;Cicco19&#39;</span><span class="p">:</span>
        <span class="n">label</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;VLT Cosmos&#39;</span><span class="p">]</span>                
    <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

<span class="c1">#changing order of labels in dictionary only for text to be readable on the plot</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="n">key_order</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SDSS&#39;</span><span class="p">,</span><span class="s1">&#39;TDE&#39;</span><span class="p">,</span><span class="s1">&#39;CL AGN&#39;</span><span class="p">,</span> <span class="s1">&#39;FermiBL&#39;</span><span class="p">,</span> <span class="s1">&#39;VLT Cosmos&#39;</span><span class="p">,</span><span class="s1">&#39;Palomar variable 20&#39;</span><span class="p">,</span><span class="s1">&#39;WISE-Variable&#39;</span><span class="p">,</span> <span class="s1">&#39;Galex variable 22&#39;</span><span class="p">)</span>
<span class="n">new_queue</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key_order</span><span class="p">:</span>
    <span class="n">new_queue</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">seen</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Sample consists of:&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">new_queue</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="n">labels</span><span class="o">=</span><span class="n">new_queue</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">autopct</span><span class="o">=</span><span class="n">autopct_format</span><span class="p">(</span><span class="n">new_queue</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">textprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">},</span><span class="n">startangle</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>  <span class="n">labeldistance</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">wedgeprops</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;linewidth&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span> <span class="p">:</span> <span class="s1">&#39;white&#39;</span> <span class="p">},</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In this particular example, the largest three subsamples are AGNs selected from <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2015yCat..18100014A/similar">gamma ray observations by the Fermi Large Area Telescope</a> (with more than 98% blazars), AGNs from the optical spectra by the <a class="reference external" href="https://www.sdss4.org/dr17/algorithms/qso_catalog/">SDSS quasar sample DR16Q</a> with a criteria on redshift (z&lt;2), and a subset of AGNs selected in MIR WISE bands based on their variability (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2019AAS...23333004P/abstract">csv in data folder credit RChary</a>). We also include some smaller samples from the literature to see where they sit compared to the rest of the population and if they are localized on the 2D projection. These include the Changing Look AGNs from the literature (e.g., <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2015ApJ...800..144L/abstract">LaMassa et al. 2015</a>, <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2022ApJ...927..227L/abstract">Lyu et al. 2022</a>, <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2022MNRAS.511...54H/abstract">Hon et al. 2022</a>), a sample which showed variability in Galex UV images (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2022ApJ...933...37W/abstract">Wasleske et al. 2022</a>), a sample of variable sources identified in optical Palomar observarions (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2020ApJ...896...10B/abstract">Baldassare et al. 2020</a>), and the optically variable AGNs in the COSMOS field from a three year program on VLT(<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2019A%26A...627A..33D/abstract">De Cicco et al. 2019</a>). We also include 30 Tidal Disruption Event coordinates identified from ZTF light curves <a class="reference external" href="https://iopscience.iop.org/article/10.3847/1538-4357/aca283/meta">Hammerstein et al. 2023</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">seen</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">objid</span><span class="p">:</span>
    <span class="n">singleobj</span> <span class="o">=</span> <span class="n">parallel_df_lc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">b</span><span class="p">,:,:,:]</span>  
    <span class="n">label</span> <span class="o">=</span> <span class="n">singleobj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
    <span class="n">bands</span> <span class="o">=</span> <span class="n">singleobj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">],:,:]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;band&#39;</span><span class="p">)[:]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Number of lightcurves in each waveband in this sample:&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">seen</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">seen</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The histogram shows the number of lightcurves which ended up in the multi-index data frame from each of the archive calls in different wavebands/filters. We note that the IceCube peak should be corrected as it also include non detections in the figure above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cadence</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">el</span><span class="p">,[])</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">seen</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">timerange</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">el</span><span class="p">,[])</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">seen</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">objid</span><span class="p">:</span>
    <span class="n">singleobj</span> <span class="o">=</span> <span class="n">parallel_df_lc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">b</span><span class="p">,:,:,:]</span>  
    <span class="n">label</span> <span class="o">=</span> <span class="n">singleobj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
    <span class="n">bband</span> <span class="o">=</span> <span class="n">singleobj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s1">&#39;band&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">bb</span> <span class="ow">in</span> <span class="n">bband</span><span class="p">:</span>
        <span class="n">bands</span> <span class="o">=</span> <span class="n">singleobj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bb</span><span class="p">,:]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)[:]</span>
        <span class="c1">#bands.values</span>
        <span class="c1">#print(bb,len(bands[:]),np.round(bands[:].max()-bands[:].min(),1))    </span>
        <span class="n">cadence</span><span class="p">[</span><span class="n">bb</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bands</span><span class="p">[:]))</span>
        <span class="k">if</span> <span class="n">bands</span><span class="p">[:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">bands</span><span class="p">[:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">timerange</span><span class="p">[</span><span class="n">bb</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bands</span><span class="p">[:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">bands</span><span class="p">[:]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="mi">1</span><span class="p">))</span>    

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time range and cadence covered in each in each waveband averaged over this sample:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">cadence</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c1">#print(el,len(cadence[el]),np.mean(cadence[el]),np.std(cadence[el]))</span>
    <span class="c1">#print(el,len(timerange[el]),np.mean(timerange[el]),np.std(timerange[el]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">timerange</span><span class="p">[</span><span class="n">el</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cadence</span><span class="p">[</span><span class="n">el</span><span class="p">]),</span><span class="n">label</span><span class="o">=</span><span class="n">el</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">timerange</span><span class="p">[</span><span class="n">el</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">timerange</span><span class="p">[</span><span class="n">el</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cadence</span><span class="p">[</span><span class="n">el</span><span class="p">]),</span><span class="n">xerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">timerange</span><span class="p">[</span><span class="n">el</span><span class="p">]),</span><span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cadence</span><span class="p">[</span><span class="n">el</span><span class="p">]),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">el</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">timerange</span><span class="p">[</span><span class="n">el</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cadence</span><span class="p">[</span><span class="n">el</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Average number of visits&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Average baseline (days)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">4000</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>While from the histogram plot we see which bands have the highest number of observed lightcurves, what might matter more in finding/selecting variability or changing look in lightcurves is the cadence and the average baseline of observations. For instance, Panstarrs has a large number of lightcurve detections in our sample, but from the figure above we see that the average number of visits and the baseline for those observations are considerably less than ZTF. WISE also shows the longest baseline of observations which is suitable to finding longer term variability in objects.</p>
</section>
<section id="looking-at-ztf-lightcurves-alone">
<h2>Looking at ZTF lightcurves alone<a class="headerlink" href="#looking-at-ztf-lightcurves-alone" title="Permalink to this headline">#</a></h2>
<p>We first look at this sample only in ZTF bands which have the largest number of visits. We start by unifying the time grid of the light curves so oobjects with different start time or number of observations can be compared. We do this by interpolation to a new grid. The choice of the grid resolution and baseline is strictly dependent on the input data, in this case ZTF, to preserve as much as possible all the information from the observations. We measure basic statistics and combine the tree observed ZTF bands into one longer array as input to dimensionailty reduction after deciding on normalization. We also do a shuffling of the sample to be sure that the separations of different classes by ML are not simply due to the order they are seen in training (in case it is not done by the ML routine itself).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bands_inlc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;zg&#39;</span><span class="p">,</span><span class="s1">&#39;zr&#39;</span><span class="p">,</span><span class="s1">&#39;zi&#39;</span><span class="p">]</span>
<span class="n">objects</span><span class="p">,</span><span class="n">dobjects</span><span class="p">,</span><span class="n">flabels</span> <span class="o">=</span> <span class="n">unify_lc</span><span class="p">(</span><span class="n">parallel_df_lc</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">,</span><span class="n">xres</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="n">numplots</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># calculate some basic statistics</span>
<span class="n">fvar</span><span class="p">,</span> <span class="n">maxarray</span><span class="p">,</span> <span class="n">meanarray</span> <span class="o">=</span> <span class="n">stat_bands</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span><span class="n">dobjects</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">)</span>

<span class="c1"># combine different waveband into one array</span>
<span class="n">dat_notnormal</span> <span class="o">=</span> <span class="n">combine_bands</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">)</span>

<span class="c1"># Normalize the combinde array by maximum of brightness in a waveband after clipping outliers:</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">normalize_clipmax_objects</span><span class="p">(</span><span class="n">dat_notnormal</span><span class="p">,</span><span class="n">maxarray</span><span class="p">,</span><span class="n">band</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Normalize the combinde array by mean brightness in a waveband after clipping outliers:</span>
<span class="n">datm</span> <span class="o">=</span> <span class="n">normalize_clipmax_objects</span><span class="p">(</span><span class="n">dat_notnormal</span><span class="p">,</span><span class="n">meanarray</span><span class="p">,</span><span class="n">band</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># shuffle data incase the ML routines are sensitive to order</span>
<span class="n">data</span><span class="p">,</span><span class="n">fzr</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">shuffle_datalabel</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">flabels</span><span class="p">)</span>
<span class="n">fvar_arr</span><span class="p">,</span><span class="n">maximum_arr</span><span class="p">,</span><span class="n">average_arr</span> <span class="o">=</span> <span class="n">fvar</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span><span class="n">maxarray</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span><span class="n">meanarray</span><span class="p">[:,</span><span class="n">p</span><span class="p">]</span>

<span class="c1"># Fix label of all changing looks and TDEs </span>
<span class="n">cl_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LaMassa 15&#39;</span><span class="p">,</span><span class="s1">&#39;Green 22&#39;</span><span class="p">,</span><span class="s1">&#39;Hon 22&#39;</span><span class="p">,</span><span class="s1">&#39;Lyu 21&#39;</span><span class="p">,</span><span class="s1">&#39;Sheng 20&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 19&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 16&#39;</span><span class="p">,</span><span class="s1">&#39;Ruan 16&#39;</span><span class="p">,</span><span class="s1">&#39;Yang 18&#39;</span><span class="p">,</span><span class="s1">&#39;Lopez-Navas 22&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">cl_labels</span><span class="p">:</span>
        <span class="n">fzr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CL AGN&#39;</span>
    <span class="k">if</span> <span class="n">l</span><span class="o">==</span><span class="s1">&#39;ZTF-Objname&#39;</span><span class="p">:</span>
        <span class="n">fzr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TDE&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>The combination of the tree bands into one longer arrays in order of increasing wavelength, can be seen as providing both the SED shape as well as variability in each from the light curve. Figure below demonstrates this as well as our normalization choice. We normalize the data in ZTF R band as it has a higher average numbe of visits compared to G and I band. We remove outliers before measuring the mean and max of the light curve and normalizing by it. This normalization can be skipped if one is mearly interested in comparing brightnesses of the data in this sample, but as dependence on flux is strong to look for variability and compare shapes of light curves a normalization helps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dat</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands_inlc</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dat</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bands_inlc</span><span class="p">))</span>
    <span class="n">first</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">first</span><span class="o">+</span><span class="n">s</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="n">last</span><span class="p">,</span><span class="n">s</span><span class="p">),</span><span class="n">dat_notnormal</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">first</span><span class="p">:</span><span class="n">last</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time_[w1,w2,w3]&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Flux ($\mu Jy$)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands_inlc</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dat</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bands_inlc</span><span class="p">))</span>
    <span class="n">first</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">first</span><span class="o">+</span><span class="n">s</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="n">last</span><span class="p">,</span><span class="n">s</span><span class="p">),</span><span class="n">dat</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">first</span><span class="p">:</span><span class="n">last</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time_[w1,w2,w3]&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Normalized Flux (max r band)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands_inlc</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dat</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bands_inlc</span><span class="p">))</span>
    <span class="n">first</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">first</span><span class="o">+</span><span class="n">s</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="n">last</span><span class="p">,</span><span class="n">s</span><span class="p">),</span><span class="n">datm</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">first</span><span class="p">:</span><span class="n">last</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time_[w1,w2,w3]&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Normalized Flux (mean r band)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can train a UMAP with the processed data vectors above. Different choices for the number of neighbors, minimum distance and metric can be made and a parameter space can be explored. We show here our preferred combination given this data. We choose manhattan distance (also called <a class="reference external" href="https://en.wikipedia.org/wiki/Taxicab_geometry">the L1 distance</a>) as it is optimal for the kind of grid we interpolated on, for instance we want the distance to not change if there are observations missing. Another metric appropriate for our purpose in time domain analysis is Dynamic Time Warping (<a class="reference external" href="https://en.wikipedia.org/wiki/Dynamic_time_warping">DTW</a>), which is insensitive to a shift in time. This is helpful as we interpolate the observations onto a grid starting from time 0 and when discussing variability we care less about when it happens and more about whether and how strong it happened. As the measurement of the DTW distance takes longer compared to the other metrics we show examples here with manhattan and only show one example exploring the parameter space including a DTW metric in the last cell of this notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">markersize</span><span class="o">=</span><span class="mi">200</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">min_dist</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;manhattan&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mean brightness&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">meanarray</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mean fractional variation&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">stretch_small_values_arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">fvar_arr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">factor</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;sample origin&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1">#plt.savefig(&#39;umap-ztf.png&#39;)</span>
</pre></div>
</div>
</div>
</div>
<p>The left panel is colorcoded by the origin of the sample. The middle panel shows the sum of mean brightnesses in three bands (arbitrary unit) demonstrating that after normalization we see no correlation with brightness. The panel on the right is color coded by a statistical measure of variability (i.e. the fractional variation <a class="reference external" href="https://ned.ipac.caltech.edu/level5/Sept01/Peterson2/Peter2_1.html">see here</a>). As with the plotting above it is not easy to see all the data points and correlations in the next two cells measure probability of belonging to each original sample as well as the mean statistical property on an interpolated grid on this reduced 2D projected surface.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a grid</span>
<span class="n">grid_resolution</span> <span class="o">=</span> <span class="mi">25</span><span class="c1"># Number of cells in the grid</span>
<span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">grid_resolution</span><span class="p">)</span>
<span class="n">y_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">grid_resolution</span><span class="p">)</span>
<span class="n">x_centers</span><span class="p">,</span> <span class="n">y_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span><span class="p">)</span>

<span class="c1"># Calculate mean property in each grid cell</span>
<span class="n">mean_property1</span><span class="p">,</span><span class="n">mean_property2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_centers</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_centers</span><span class="p">)</span>
<span class="n">propmean</span><span class="o">=</span><span class="n">stretch_small_values_arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">meanarray</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">propfvar</span><span class="o">=</span><span class="n">stretch_small_values_arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">fvar_arr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_resolution</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_resolution</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">x_grid</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x_grid</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">y_grid</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y_grid</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mean_property1</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">propmean</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
            <span class="n">mean_property2</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">propfvar</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
            
            
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;mean brightness&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x_centers</span><span class="p">,</span> <span class="n">y_centers</span><span class="p">,</span> <span class="n">mean_property1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="c1">#plt.axis(&#39;off&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;mean fractional variation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x_centers</span><span class="p">,</span> <span class="n">y_centers</span><span class="p">,</span> <span class="n">mean_property2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="c1">#plt.axis(&#39;off&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate 2D histogram</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Calculate class probabilities for each bin</span>
<span class="n">class_probabilities</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">hist_per_cluster</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span><span class="p">))</span>
    <span class="n">class_prob</span> <span class="o">=</span> <span class="n">hist_per_cluster</span> <span class="o">/</span> <span class="n">hist</span>
    <span class="n">class_probabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_prob</span><span class="p">)</span>
    <span class="c1">#print(lab, class_prob)</span>

<span class="n">labs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_probabilities</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">prob</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Figure above shows how with ZTF light curves alone we can separate some of these AGN samples, where they have overlaps. We can do a similar exercise with other dimensionality reduction techniques. Below we show two SOMs one with normalized and another with no normalization. The advantage of Umaps to SOMs is that in practice you may change the parameters to separate classes of vastly different data points, as distance is preserved on a umap. On a SOM however only topology of higher dimensions is preserved and not distance hence, the change on the 2d grid does not need to be smooth and from one cell to next there might be larg jumps. On the other hand, an advantage of the SOM is that by definition it has a grid and no need for a posterior interpolation (as we did above) is needed to map more data or to measure probabilities, etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sompy</span> <span class="kn">import</span> <span class="o">*</span> <span class="c1">#using the SOMPY package from https://github.com/sevamoo/SOMPY</span>
<span class="n">msz0</span><span class="p">,</span><span class="n">msz1</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span><span class="mi">12</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">sompy</span><span class="o">.</span><span class="n">SOMFactory</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mapsize</span><span class="o">=</span><span class="p">[</span><span class="n">msz0</span><span class="p">,</span><span class="n">msz1</span><span class="p">],</span> <span class="n">mapshape</span><span class="o">=</span><span class="s1">&#39;planar&#39;</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span> <span class="n">initialization</span><span class="o">=</span><span class="s1">&#39;pca&#39;</span><span class="p">)</span> 
<span class="n">sm</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">n_job</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shared_memory</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">bmu_ind_to_xy</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">project_data</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>    
<span class="n">med_r</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">msz0</span><span class="p">,</span><span class="n">msz1</span><span class="p">])</span>
<span class="n">fvar_new</span> <span class="o">=</span> <span class="n">stretch_small_values_arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">fvar_arr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">factor</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">msz0</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">msz1</span><span class="p">):</span>
        <span class="n">unja</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="n">i</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="n">j</span><span class="p">)</span>
        <span class="n">med_r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">fvar_new</span><span class="p">[</span><span class="n">unja</span><span class="p">]))</span>
        

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SDSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">cf</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">med_r</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">==</span><span class="s1">&#39;SDSS&#39;</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
<span class="n">dsdss</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">asdss</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">bmu_ind_to_xy</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">project_data</span><span class="p">(</span><span class="n">dsdss</span><span class="p">))</span>                   
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">asdss</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">asdss</span><span class="p">))</span>
<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">asdss</span><span class="p">:</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;WISE Variable&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">cf</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">med_r</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">==</span><span class="s1">&#39;WISE-Variable&#39;</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
<span class="n">dwise</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">awise</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">bmu_ind_to_xy</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">project_data</span><span class="p">(</span><span class="n">dwise</span><span class="p">))</span>                   
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">awise</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">awise</span><span class="p">))</span>
<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">awise</span><span class="p">:</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CICCO 2019&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">cf</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">med_r</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">==</span><span class="s1">&#39;Cicco19&#39;</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
<span class="n">dcic</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">acic</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">bmu_ind_to_xy</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">project_data</span><span class="p">(</span><span class="n">dcic</span><span class="p">))</span>                   
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acic</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acic</span><span class="p">))</span>
<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">acic</span><span class="p">:</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Changing Look AGNs&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">cf</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">med_r</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">==</span><span class="s1">&#39;CL AGN&#39;</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
<span class="n">dcic</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">acic</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">bmu_ind_to_xy</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">project_data</span><span class="p">(</span><span class="n">dcic</span><span class="p">))</span>                   
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acic</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acic</span><span class="p">))</span>
<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">acic</span><span class="p">:</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The above SOMs are colored by the mean fractional variation of the lightcurves in all bands (a measure of AGN variability). The crosses are different samples mapped to the trained SOM to see if they are distinguishable on a normalized lightcurve som.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># shuffle data incase the ML routines are sensitive to order</span>
<span class="n">data</span><span class="p">,</span><span class="n">fzr</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">shuffle_datalabel</span><span class="p">(</span><span class="n">dat_notnormal</span><span class="p">,</span><span class="n">flabels</span><span class="p">)</span>
<span class="n">fvar_arr</span><span class="p">,</span><span class="n">maximum_arr</span><span class="p">,</span><span class="n">average_arr</span> <span class="o">=</span> <span class="n">fvar</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span><span class="n">maxarray</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span><span class="n">meanarray</span><span class="p">[:,</span><span class="n">p</span><span class="p">]</span>
<span class="n">cl_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LaMassa 15&#39;</span><span class="p">,</span><span class="s1">&#39;Green 22&#39;</span><span class="p">,</span><span class="s1">&#39;Hon 22&#39;</span><span class="p">,</span><span class="s1">&#39;Lyu 21&#39;</span><span class="p">,</span><span class="s1">&#39;Sheng 20&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 19&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 16&#39;</span><span class="p">,</span><span class="s1">&#39;Ruan 16&#39;</span><span class="p">,</span><span class="s1">&#39;Yang 18&#39;</span><span class="p">,</span><span class="s1">&#39;Lopez-Navas 22&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">cl_labels</span><span class="p">:</span>
        <span class="n">fzr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CL AGN&#39;</span>
    <span class="k">if</span> <span class="n">l</span><span class="o">==</span><span class="s1">&#39;ZTF-Objname&#39;</span><span class="p">:</span>
        <span class="n">fzr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TDE&#39;</span>       
<span class="n">sm</span> <span class="o">=</span> <span class="n">sompy</span><span class="o">.</span><span class="n">SOMFactory</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mapsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">mapshape</span><span class="o">=</span><span class="s1">&#39;planar&#39;</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span> <span class="n">initialization</span><span class="o">=</span><span class="s1">&#39;pca&#39;</span><span class="p">)</span> 
<span class="n">sm</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">n_job</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shared_memory</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">bmu_ind_to_xy</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">project_data</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>    
<span class="n">med_r</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">msz0</span><span class="p">,</span><span class="n">msz1</span><span class="p">])</span>
<span class="n">fvar_new</span> <span class="o">=</span> <span class="n">stretch_small_values_arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">maximum_arr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">msz0</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">msz1</span><span class="p">):</span>
        <span class="n">unja</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="n">i</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="n">j</span><span class="p">)</span>
        <span class="n">med_r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">fvar_new</span><span class="p">[</span><span class="n">unja</span><span class="p">]))</span>
        

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;SDSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">cf</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">med_r</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">==</span><span class="s1">&#39;SDSS&#39;</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
<span class="n">dsdss</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">asdss</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">bmu_ind_to_xy</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">project_data</span><span class="p">(</span><span class="n">dsdss</span><span class="p">))</span>                   
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">asdss</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">asdss</span><span class="p">))</span>
<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">asdss</span><span class="p">:</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;WISE Variable&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">cf</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">med_r</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">==</span><span class="s1">&#39;WISE-Variable&#39;</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
<span class="n">dwise</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">awise</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">bmu_ind_to_xy</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">project_data</span><span class="p">(</span><span class="n">dwise</span><span class="p">))</span>                   
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">awise</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">awise</span><span class="p">))</span>
<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">awise</span><span class="p">:</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;CICCO 2019&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">cf</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">med_r</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">==</span><span class="s1">&#39;Cicco19&#39;</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
<span class="n">dcic</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">acic</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">bmu_ind_to_xy</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">project_data</span><span class="p">(</span><span class="n">dcic</span><span class="p">))</span>                   
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acic</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acic</span><span class="p">))</span>
<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">acic</span><span class="p">:</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Changing Look AGNs&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">cf</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">med_r</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">==</span><span class="s1">&#39;CL AGN&#39;</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
<span class="n">dcic</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">acic</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">bmu_ind_to_xy</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">project_data</span><span class="p">(</span><span class="n">dcic</span><span class="p">))</span>                   
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acic</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acic</span><span class="p">))</span>
<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">acic</span><span class="p">:</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>skipping the normalization of lightcurves, can show for example how the Cicco et al. 2019 sample, from the 3year VLT observations of the COSMOS field are all fainter compared to the rest.</p>
</section>
</section>
<section id="repeating-the-above-this-time-with-panstarrs-observations">
<h1>Repeating the above, this time with Panstarrs observations<a class="headerlink" href="#repeating-the-above-this-time-with-panstarrs-observations" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bands_inlc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;panstarrs g&#39;</span><span class="p">,</span><span class="s1">&#39;panstarrs r&#39;</span><span class="p">,</span><span class="s1">&#39;panstarrs i&#39;</span><span class="p">,</span><span class="s1">&#39;panstarrs z&#39;</span><span class="p">,</span> <span class="s1">&#39;panstarrs y&#39;</span><span class="p">]</span>
<span class="n">objects</span><span class="p">,</span><span class="n">dobjects</span><span class="p">,</span><span class="n">flabels</span> <span class="o">=</span> <span class="n">unify_lc</span><span class="p">(</span><span class="n">parallel_df_lc</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">,</span><span class="n">xres</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># calculate some basic statistics</span>
<span class="n">fvar</span><span class="p">,</span> <span class="n">maxarray</span><span class="p">,</span> <span class="n">meanarray</span> <span class="o">=</span> <span class="n">stat_bands</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span><span class="n">dobjects</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">)</span>

<span class="c1"># combine different waveband into one array</span>
<span class="n">dat_notnormal</span> <span class="o">=</span> <span class="n">combine_bands</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">)</span>

<span class="c1"># Normalize the combinde array by maximum of brightness in a waveband after clipping outliers:</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">normalize_clipmax_objects</span><span class="p">(</span><span class="n">dat_notnormal</span><span class="p">,</span><span class="n">maxarray</span><span class="p">,</span><span class="n">band</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Normalize the combinde array by mean brightness in a waveband after clipping outliers:</span>
<span class="n">datm</span> <span class="o">=</span> <span class="n">normalize_clipmax_objects</span><span class="p">(</span><span class="n">dat_notnormal</span><span class="p">,</span><span class="n">meanarray</span><span class="p">,</span><span class="n">band</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># shuffle data incase the ML routines are sensitive to order</span>
<span class="n">data</span><span class="p">,</span><span class="n">fzr</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">shuffle_datalabel</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">flabels</span><span class="p">)</span>
<span class="n">fvar_arr</span><span class="p">,</span><span class="n">maximum_arr</span><span class="p">,</span><span class="n">average_arr</span> <span class="o">=</span> <span class="n">fvar</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span><span class="n">maxarray</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span><span class="n">meanarray</span><span class="p">[:,</span><span class="n">p</span><span class="p">]</span>

<span class="c1"># Fix label of all changing looks and TDEs </span>
<span class="n">cl_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LaMassa 15&#39;</span><span class="p">,</span><span class="s1">&#39;Green 22&#39;</span><span class="p">,</span><span class="s1">&#39;Hon 22&#39;</span><span class="p">,</span><span class="s1">&#39;Lyu 21&#39;</span><span class="p">,</span><span class="s1">&#39;Sheng 20&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 19&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 16&#39;</span><span class="p">,</span><span class="s1">&#39;Ruan 16&#39;</span><span class="p">,</span><span class="s1">&#39;Yang 18&#39;</span><span class="p">,</span><span class="s1">&#39;Lopez-Navas 22&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">cl_labels</span><span class="p">:</span>
        <span class="n">fzr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CL AGN&#39;</span>
    <span class="k">if</span> <span class="n">l</span><span class="o">==</span><span class="s1">&#39;ZTF-Objname&#39;</span><span class="p">:</span>
        <span class="n">fzr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TDE&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">markersize</span><span class="o">=</span><span class="mi">200</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">min_dist</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;manhattan&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mean brightness&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">meanarray</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mean fractional variation&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">stretch_small_values_arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">fvar_arr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;sample origin&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#plt.savefig(&#39;umap-Panstarrs.png&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate 2D histogram</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Calculate class probabilities for each bin</span>
<span class="n">class_probabilities</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">hist_per_cluster</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span><span class="p">))</span>
    <span class="n">class_prob</span> <span class="o">=</span> <span class="n">hist_per_cluster</span> <span class="o">/</span> <span class="n">hist</span>
    <span class="n">class_probabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_prob</span><span class="p">)</span>
    <span class="c1">#print(lab, class_prob)</span>

<span class="n">labs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_probabilities</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">prob</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ztf-wise">
<h1>ZTF + WISE<a class="headerlink" href="#ztf-wise" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bands_inlc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;zg&#39;</span><span class="p">,</span><span class="s1">&#39;zr&#39;</span><span class="p">,</span><span class="s1">&#39;zi&#39;</span><span class="p">,</span><span class="s1">&#39;W1&#39;</span><span class="p">,</span><span class="s1">&#39;W2&#39;</span><span class="p">]</span>
<span class="n">objects</span><span class="p">,</span><span class="n">dobjects</span><span class="p">,</span><span class="n">flabels</span> <span class="o">=</span> <span class="n">unify_lc</span><span class="p">(</span><span class="n">parallel_df_lc</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">,</span><span class="n">xres</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">numplots</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># calculate some basic statistics</span>
<span class="n">fvar</span><span class="p">,</span> <span class="n">maxarray</span><span class="p">,</span> <span class="n">meanarray</span> <span class="o">=</span> <span class="n">stat_bands</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span><span class="n">dobjects</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">)</span>
<span class="n">dat_notnormal</span> <span class="o">=</span> <span class="n">combine_bands</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">)</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">normalize_clipmax_objects</span><span class="p">(</span><span class="n">dat_notnormal</span><span class="p">,</span><span class="n">maxarray</span><span class="p">,</span><span class="n">band</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="p">,</span><span class="n">fzr</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">shuffle_datalabel</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">flabels</span><span class="p">)</span>
<span class="n">fvar_arr</span><span class="p">,</span><span class="n">maximum_arr</span><span class="p">,</span><span class="n">average_arr</span> <span class="o">=</span> <span class="n">fvar</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span><span class="n">maxarray</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span><span class="n">meanarray</span><span class="p">[:,</span><span class="n">p</span><span class="p">]</span>

<span class="c1"># Fix label of all changing looks and TDEs </span>
<span class="n">cl_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LaMassa 15&#39;</span><span class="p">,</span><span class="s1">&#39;Green 22&#39;</span><span class="p">,</span><span class="s1">&#39;Hon 22&#39;</span><span class="p">,</span><span class="s1">&#39;Lyu 21&#39;</span><span class="p">,</span><span class="s1">&#39;Sheng 20&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 19&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 16&#39;</span><span class="p">,</span><span class="s1">&#39;Ruan 16&#39;</span><span class="p">,</span><span class="s1">&#39;Yang 18&#39;</span><span class="p">,</span><span class="s1">&#39;Lopez-Navas 22&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">cl_labels</span><span class="p">:</span>
        <span class="n">fzr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CL AGN&#39;</span>
    <span class="k">if</span> <span class="n">l</span><span class="o">==</span><span class="s1">&#39;ZTF-Objname&#39;</span><span class="p">:</span>
        <span class="n">fzr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TDE&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">markersize</span><span class="o">=</span><span class="mi">200</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">min_dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;manhattan&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mean brightness&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">stretch_small_values_arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">meanarray</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">factor</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mean fractional variation&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">stretch_small_values_arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">fvar_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">factor</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;sample origin&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate 2D histogram</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Calculate class probabilities for each bin</span>
<span class="n">class_probabilities</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">hist_per_cluster</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span><span class="p">))</span>
    <span class="n">class_prob</span> <span class="o">=</span> <span class="n">hist_per_cluster</span> <span class="o">/</span> <span class="n">hist</span>
    <span class="n">class_probabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_prob</span><span class="p">)</span>
    <span class="c1">#print(lab, class_prob)</span>

<span class="n">labs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_probabilities</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">prob</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="wise-alone">
<h1>Wise alone<a class="headerlink" href="#wise-alone" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bands_inlc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;W1&#39;</span><span class="p">,</span><span class="s1">&#39;W2&#39;</span><span class="p">]</span>
<span class="n">objects</span><span class="p">,</span><span class="n">dobjects</span><span class="p">,</span><span class="n">flabels</span> <span class="o">=</span> <span class="n">unify_lc</span><span class="p">(</span><span class="n">parallel_df_lc</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">,</span><span class="n">xres</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="c1"># calculate some basic statistics</span>
<span class="n">fvar</span><span class="p">,</span> <span class="n">maxarray</span><span class="p">,</span> <span class="n">meanarray</span> <span class="o">=</span> <span class="n">stat_bands</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span><span class="n">dobjects</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">)</span>
<span class="n">dat_notnormal</span> <span class="o">=</span> <span class="n">combine_bands</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span><span class="n">bands_inlc</span><span class="p">)</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">normalize_clipmax_objects</span><span class="p">(</span><span class="n">dat_notnormal</span><span class="p">,</span><span class="n">maxarray</span><span class="p">,</span><span class="n">band</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="p">,</span><span class="n">fzr</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">shuffle_datalabel</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">flabels</span><span class="p">)</span>
<span class="n">fvar_arr</span><span class="p">,</span><span class="n">maximum_arr</span><span class="p">,</span><span class="n">average_arr</span> <span class="o">=</span> <span class="n">fvar</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span><span class="n">maxarray</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span><span class="n">meanarray</span><span class="p">[:,</span><span class="n">p</span><span class="p">]</span>

<span class="c1"># Fix label of all changing looks and TDEs </span>
<span class="n">cl_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LaMassa 15&#39;</span><span class="p">,</span><span class="s1">&#39;Green 22&#39;</span><span class="p">,</span><span class="s1">&#39;Hon 22&#39;</span><span class="p">,</span><span class="s1">&#39;Lyu 21&#39;</span><span class="p">,</span><span class="s1">&#39;Sheng 20&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 19&#39;</span><span class="p">,</span><span class="s1">&#39;MacLeod 16&#39;</span><span class="p">,</span><span class="s1">&#39;Ruan 16&#39;</span><span class="p">,</span><span class="s1">&#39;Yang 18&#39;</span><span class="p">,</span><span class="s1">&#39;Lopez-Navas 22&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fzr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">cl_labels</span><span class="p">:</span>
        <span class="n">fzr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CL AGN&#39;</span>
    <span class="k">if</span> <span class="n">l</span><span class="o">==</span><span class="s1">&#39;ZTF-Objname&#39;</span><span class="p">:</span>
        <span class="n">fzr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TDE&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">markersize</span><span class="o">=</span><span class="mi">200</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">min_dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;manhattan&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mean brightness&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">meanarray</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mean fractional variation&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">stretch_small_values_arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">fvar_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">factor</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;sample origin&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#plt.savefig(&#39;umap-wise.png&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate 2D histogram</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Calculate class probabilities for each bin</span>
<span class="n">class_probabilities</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">hist_per_cluster</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span><span class="p">))</span>
    <span class="n">class_prob</span> <span class="o">=</span> <span class="n">hist_per_cluster</span> <span class="o">/</span> <span class="n">hist</span>
    <span class="n">class_probabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_prob</span><span class="p">)</span>
    <span class="c1">#print(lab, class_prob)</span>

<span class="n">labs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_probabilities</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">prob</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#plt.savefig(&#39;wise.png&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">markersize</span><span class="o">=</span><span class="mi">200</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">min_dist</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Euclidean Distance, min_d=0.01, n_neighbors=5&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">min_dist</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;manhattan&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Manhattan Distance, min_d=0.5, n_neighbors=50&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>


<span class="n">mapperg</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">min_dist</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">metric</span><span class="o">=</span><span class="n">dtw_distance</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1">#this distance takes long</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;DTW Distance, min_d=0.5,n_neighbors=50&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapperg</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapperg</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>


<span class="n">mapper</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">min_dist</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;manhattan&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Manhattan Distance, min_d=0.1, n_neighbors=7&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fzr</span><span class="p">)):</span>
    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">fzr</span><span class="p">[:]</span><span class="o">==</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mapper</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="lc_classifier.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Light Curve Classifier</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Fornax developers<br/>
  
      &copy; Copyright 2022-2023, Fornax developers.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>